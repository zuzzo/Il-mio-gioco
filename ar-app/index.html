<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applicazione AR</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="ar-view">
            <video id="camera-feed" autoplay playsinline muted></video>
            <canvas id="render-canvas"></canvas>
        </div>
        
        <div class="control-panel">
            <div class="slider vertical" id="distance-slider">
                <input type="range" min="1" max="10" value="5" id="distance-input">
                <span id="distance-value">5m</span>
            </div>
            
            <div class="slider horizontal" id="rotation-slider">
                <input type="range" min="0" max="360" value="0" id="rotation-input">
                <span id="rotation-value">0°</span>
            </div>
            
            <div class="button-group">
                <button id="confirm-btn" class="primary">Conferma</button>
                <button id="cancel-btn" class="secondary">Annulla</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inizializzazione
            const cameraFeed = document.getElementById('camera-feed');
            const canvas = document.getElementById('render-canvas');
            const engine = new BABYLON.Engine(canvas, true);
            const scene = new BABYLON.Scene(engine);
            const camera = new BABYLON.ArcRotateCamera("Camera", 0, 0, 0, BABYLON.Vector3.Zero(), scene);
            
            // Configurazione fotocamera
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                } 
            })
            .then(stream => {
                cameraFeed.srcObject = stream;
                cameraFeed.play();
            })
            .catch(err => {
                console.error("Errore fotocamera:", err);
                alert("Errore nell'accesso alla fotocamera. Verifica i permessi.");
            });
            
            // Gestione controlli
            document.getElementById('distance-input').addEventListener('input', updateDistance);
            document.getElementById('rotation-input').addEventListener('input', updateRotation);
            document.getElementById('confirm-btn').addEventListener('click', confirmPlacement);
            document.getElementById('cancel-btn').addEventListener('click', cancelPlacement);
            
            function updateDistance() {
                const value = document.getElementById('distance-input').value;
                document.getElementById('distance-value').textContent = value + 'm';
                // Aggiorna la posizione dell'oggetto
            }
            
            function updateRotation() {
                const value = document.getElementById('rotation-input').value;
                document.getElementById('rotation-value').textContent = value + '°';
                // Aggiorna la rotazione dell'oggetto
            }
            
            function confirmPlacement() {
                // Logica per confermare il posizionamento
                alert("Oggetto posizionato con successo!");
            }
            
            function cancelPlacement() {
                // Logica per annullare il posizionamento
                alert("Posizionamento annullato");
            }
            
            engine.runRenderLoop(() => {
                scene.render();
            });
            
            window.addEventListener('resize', () => {
                engine.resize();
            });
        });
    </script>
</body>
</html>
