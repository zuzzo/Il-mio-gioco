<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Geolocalizzata</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> <!-- Font Awesome for icons -->
    
    <!-- Babylon.js -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    
    <!-- Meta tag per forzare HTTPS -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    
    <!-- Gestione della geolocalizzazione e dell'AR -->
    <script src="scripts/geo-manager.js" defer></script>
    <script src="scripts/ar-manager.js" defer></script>
    <script src="scripts/app.js" defer></script>
</head>
<body>
    <div class="container">
        <!-- Hamburger Menu Icon -->
        <div id="hamburger-icon">
            <i class="fas fa-bars"></i>
        </div>

        <!-- Side Menu (initially hidden) -->
        <div id="side-menu" class="hidden">
            <a href="#" id="menu-get-location"><i class="fas fa-map-marker-alt"></i> Ottieni Posizione</a>
            <div class="menu-model-selection">
                 <label for="menu-model-select"><i class="fas fa-cube"></i> Oggetto:</label>
                 <select id="menu-model-select">
                     <option value="assets/models/treasure.glb">Forziere</option>
                     <option value="assets/models/key.glb">Chiave</option>
                     <option value="assets/models/door.glb">Porta</option>
                     <option value="assets/models/custom.glb">Personalizzato</option>
                 </select>
                 <div class="menu-file-upload hidden">
                     <label for="menu-custom-model">Carica .glb:</label>
                     <input type="file" id="menu-custom-model" accept=".glb,.gltf">
                 </div>
            </div>
            <a href="#" id="menu-place-object" class="disabled"><i class="fas fa-thumbtack"></i> Piazza Oggetto</a>
            <a href="#" id="menu-toggle-ar" class="disabled"><i class="fas fa-vr-cardboard"></i> Avvia/Ferma AR</a>
            <a href="#" id="menu-clear-data" class="danger-link"><i class="fas fa-trash-alt"></i> Cancella Dati</a>
            <a href="#" id="menu-debug" class="info-link"><i class="fas fa-bug"></i> Debug</a>
            <a href="#" id="close-menu"><i class="fas fa-times"></i> Chiudi Menu</a>
        </div>

        <!-- Mode Selection -->
        <div id="modeSelector">
            <button id="switchToPlacementBtn" class="mode-btn active">Modalità Piazzamento</button>
            <button id="switchToExplorationBtn" class="mode-btn">Modalità Esplorazione</button>
        </div>

        <!-- Placement Mode UI -->
        <div id="placementModeUI" class="mode-ui active">
            <div id="placementCanvasContainer">
                <canvas id="renderCanvasPlacement" touch-action="none"></canvas>
            </div>
        </div>
        <div id="placementControls" class="mode-ui active">
            <div class="controls-section">
                <div class="model-selection">
                    <label for="model-select">Oggetti:</label>
                    <select id="model-select">
                        <option value="assets/models/treasure.glb">Forziere</option>
                        <option value="assets/models/key.glb">Chiave</option>
                        <option value="assets/models/door.glb">Porta</option>
                    </select>
                </div>
            </div>
            <!-- Removed placeObjectBtn from here -->
        </div>

        <!-- Exploration Mode UI -->
        <div id="explorationModeUI" class="mode-ui">
             <div id="infoPanelExploration">
                <div id="statusMessageExploration">Pronto per esplorare.</div>
                <div id="coordinatesExploration"></div>
                <div id="distanceExploration" class="hidden"></div>
                <div id="directionExploration" class="hidden"></div>
                <div id="directionArrowExploration" class="hidden">↑</div>
                <div id="orientationInfoExploration" class="hidden"></div>
                 <div id="savedDataInfoExploration" class="hidden"></div>
            </div>
            <!-- Removed buttons div from here -->
        </div>

        <!-- Fullscreen Canvas for Exploration AR (initially hidden) -->
        <canvas id="renderCanvasExploration" touch-action="none" class="hidden"></canvas>

        <!-- Original elements to be moved/removed -->
        <div id="infoPanel" style="display: none;"> <!-- Hide original temporarily -->
            <div id="statusMessage">Caricamento...</div>
            <div id="coordinates"></div>
            <div id="distance" class="hidden"></div>
            <div id="direction" class="hidden"></div>
            <div id="directionArrow" class="hidden">↑</div>
            <div id="orientationInfo" class="hidden"></div>
            <div id="savedDataInfo" class="hidden"></div>
            <div id="browserInfo" class="hidden"></div>
        </div>

        <!-- Moved model-selection inside placementControls -->
        <div id="placementControls">
             <div id="infoPanelPlacement">
                 <div id="statusMessagePlacement">Caricamento...</div>
                 <div id="coordinatesPlacement"></div>
                 <!-- Elements from original infoPanel moved here -->
                 <div id="orientationInfoPlacement" class="hidden"></div>
                 <div id="savedDataInfoPlacement" class="hidden"></div>
                 <div id="browserInfoPlacement" class="hidden"></div> <!-- Renamed browserInfo -->
             </div>
             <!-- Removed model-selection div from here -->
             <!-- Removed buttons div from here -->
        </div>

        <!-- Removed original renderCanvas -->
    </div>

    <!-- Notifiche browser -->
    <div id="browserNotification" class="notification hidden">
        <p>Per una migliore esperienza, è consigliato utilizzare Microsoft Edge o Google Chrome su dispositivi Android.</p>
        <button class="close-notification">Chiudi</button>
    </div>
</body>
</html>
